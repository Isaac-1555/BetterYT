import{c as _,j as e,a as H,r as l,R as D,G as F,X as L,b as X}from"./plus-icon-BzbHtC9O.js";import{c as $,g as q,d as V,k as W,l as J,u as Q,m as Z,r as ee,n as te,b as ne}from"./storage-BdOWYOIQ.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))h(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&h(r)}).observe(document,{childList:!0,subtree:!0});function d(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function h(s){if(s.ep)return;s.ep=!0;const a=d(s);fetch(s.href,a)}})();const se=()=>{const[m,c]=l.useState([]),[d,h]=l.useState(""),[s,a]=l.useState(null),[r,y]=l.useState(null),[g,N]=l.useState(""),[p,b]=l.useState(""),[x,S]=l.useState(""),[O,P]=l.useState(!0),[f,C]=l.useState(!1),[u,j]=l.useState({youtubeApiKey:"",openaiApiKey:""}),[w,I]=l.useState(!1),[A,R]=l.useState(null);l.useEffect(()=>{o(),$().then(j)},[]);const o=async()=>{const t=await q();c(t),P(!1)},E=async()=>{d.trim()&&(await J(d.trim()),h(""),o())},T=async t=>{confirm("Are you sure you want to delete this category?")&&(await Z(t),o())},z=t=>{y(t.id),N(t.name)},K=async t=>{g.trim()&&(await Q(t,g.trim()),y(null),o())},k=async t=>{!p.trim()||!x.trim()||(await ne(t,{id:p.trim(),name:x.trim()}),b(""),S(""),o())},B=async(t,i)=>{confirm("Remove channel from this category?")&&(await ee(t,i),o())},G=async(t,i,n)=>{await te(t,i,n),o()},U=t=>{R(t),chrome.runtime.sendMessage({type:"REFRESH_SUGGESTIONS",categoryId:t},()=>{R(null)})},Y=()=>{I(!0),V().then(()=>{chrome.runtime.sendMessage({type:"REFRESH_ALL_SUGGESTIONS"},()=>{I(!1)})})},M=async()=>{await W(u),C(!1)},v=(t,i)=>{t.key==="Enter"&&(t.preventDefault(),i())};return e.jsxs("div",{className:"popup-container",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"2px solid #2a2a2a",paddingBottom:"8px",marginBottom:"16px"},children:[e.jsx("h2",{style:{margin:0,border:"none",paddingBottom:0},children:"BetterYT"}),e.jsxs("div",{style:{display:"flex",gap:"6px"},children:[e.jsx("button",{className:"btn-small",onClick:Y,disabled:w,title:"Refresh all suggestion caches",style:{display:"inline-flex",alignItems:"center",justifyContent:"center"},children:w?"...":e.jsx(D,{size:16})}),e.jsx("button",{className:"btn-small",onClick:()=>C(!f),title:"Settings",style:{display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(F,{size:16})})]})]}),f&&e.jsxs("div",{className:"category-item",style:{marginBottom:"16px"},children:[e.jsxs("h3",{style:{margin:"0 0 8px 0",fontSize:"1.2rem",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(F,{size:18})," API Keys"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[e.jsx("input",{type:"text",placeholder:"YouTube Data API Key",value:u.youtubeApiKey,onChange:t=>j({...u,youtubeApiKey:t.target.value})}),e.jsx("input",{type:"text",placeholder:"OpenAI API Key (optional, for AI reranking)",value:u.openaiApiKey,onChange:t=>j({...u,openaiApiKey:t.target.value})}),e.jsxs("div",{style:{display:"flex",gap:"6px"},children:[e.jsx("button",{onClick:M,children:"Save Keys"}),e.jsx("button",{className:"btn-secondary",onClick:()=>C(!1),children:"Cancel"})]})]})]}),!O&&m.length===0&&!f&&e.jsxs("div",{className:"welcome",children:[e.jsx("p",{children:"Welcome to BetterYT!"}),e.jsx("p",{children:"Create a category below to start curating your own YouTube feeds."})]}),e.jsxs("div",{className:"add-category",children:[e.jsx("input",{type:"text",placeholder:"Category name (e.g. Coding Tutorials)",value:d,onChange:t=>h(t.target.value),onKeyDown:t=>v(t,E)}),e.jsx("button",{onClick:E,children:"Create"})]}),e.jsx("div",{className:"categories-list",children:m.map(t=>{const i=(t.seeds||[]).filter(n=>n.kind==="video");return e.jsxs("div",{className:"category-item",children:[e.jsx("div",{className:"category-header",children:r===t.id?e.jsxs("div",{className:"edit-cat",children:[e.jsx("input",{type:"text",value:g,onChange:n=>N(n.target.value),onKeyDown:n=>v(n,()=>K(t.id)),autoFocus:!0}),e.jsx("button",{onClick:()=>K(t.id),children:"Save"}),e.jsx("button",{className:"btn-secondary",onClick:()=>y(null),children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("h3",{onClick:()=>a(s===t.id?null:t.id),children:[s===t.id?"▼":"▶"," ",t.name,e.jsxs("span",{className:"channel-count",children:[t.channels.length," ch",i.length>0?` · ${i.length} vid`:""]})]}),e.jsxs("div",{className:"cat-actions",children:[e.jsx("button",{className:"btn-small",onClick:()=>U(t.id),disabled:A===t.id,title:"Refresh suggestions",style:{display:"inline-flex",alignItems:"center",justifyContent:"center"},children:A===t.id?"...":e.jsx(D,{size:14})}),e.jsx("button",{className:"btn-small",onClick:()=>z(t),title:"Rename",children:"Rename"}),e.jsx("button",{className:"btn-small btn-danger",onClick:()=>T(t.id),title:"Delete",children:"Del"})]})]})}),s===t.id&&!r&&e.jsxs("div",{className:"channels-section",children:[e.jsxs("ul",{className:"channels-list",children:[t.channels.map(n=>e.jsxs("li",{children:[e.jsxs("div",{className:"channel-info",children:[e.jsx("span",{className:"channel-name",children:n.name}),e.jsx("span",{className:"channel-id",title:n.id,children:n.id})]}),e.jsx("button",{onClick:()=>B(t.id,n.id),title:"Remove channel",style:{display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(L,{size:14})})]},n.id)),i.map(n=>e.jsxs("li",{children:[e.jsxs("div",{className:"channel-info",children:[e.jsxs("span",{className:"channel-name",style:{color:"#55aaff",display:"inline-flex",alignItems:"center",gap:"4px"},children:[e.jsx(X,{size:14,color:"#55aaff"})," ",n.title||n.id]}),e.jsx("span",{className:"channel-id",title:n.id,children:"Video seed"})]}),e.jsx("button",{onClick:()=>G(t.id,"video",n.id),title:"Remove video seed",style:{display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(L,{size:14})})]},`vs-${n.id}`)),t.channels.length===0&&i.length===0&&e.jsx("li",{className:"empty-ch",children:'No channels or video seeds yet. Use the "Add to Feed" button on YouTube or add manually below.'})]}),e.jsxs("div",{className:"add-channel",children:[e.jsx("span",{className:"add-channel-label",children:"Add channel manually:"}),e.jsx("input",{type:"text",placeholder:"Channel Name",value:x,onChange:n=>S(n.target.value)}),e.jsx("input",{type:"text",placeholder:"Channel ID (UC...)",value:p,onChange:n=>b(n.target.value),onKeyDown:n=>v(n,()=>k(t.id))}),e.jsx("button",{onClick:()=>k(t.id),children:"Add Channel"})]})]})]},t.id)})})]})},ae=document.getElementById("root"),le=_.createRoot(ae);le.render(e.jsx(H.StrictMode,{children:e.jsx(se,{})}));
