import{r as d,j as i,g as C,a as T,c as m}from"./storage-oJWc5ht-.js";const q=({category:n})=>{const[e,r]=d.useState([]),[t,s]=d.useState(!0);return d.useEffect(()=>{s(!0),r([]),chrome.runtime.sendMessage({type:"FETCH_FEED",category:n},o=>{o&&o.success?r(o.data):(console.error("[BetterYT] Failed to fetch feed",o?.error),r([])),s(!1)})},[n.id]),t?i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",padding:"48px 24px",color:"var(--yt-spec-text-secondary, #606060)",fontSize:"16px"},children:"Loading feed..."}):e.length===0?i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"48px 24px",color:"var(--yt-spec-text-secondary, #606060)",fontSize:"16px",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"32px"},children:"ðŸ“º"}),i.jsxs("span",{children:["No recent videos found for ",i.jsx("strong",{children:n.name}),"."]}),i.jsx("span",{style:{fontSize:"14px"},children:'Add channels using the "Add to Feed" button on video or channel pages.'})]}):i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(310px, 1fr))",gap:"16px 16px",padding:"16px 0",width:"100%",boxSizing:"border-box"},children:e.map(o=>i.jsx("a",{href:`/watch?v=${o.id}`,style:{textDecoration:"none",color:"inherit",display:"block"},children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",cursor:"pointer"},children:[i.jsx("img",{src:o.thumbnail,alt:o.title,style:{width:"100%",aspectRatio:"16/9",borderRadius:"12px",objectFit:"cover",backgroundColor:"var(--yt-spec-10-percent-layer, #e5e5e5)"}}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",padding:"0 4px"},children:[i.jsx("h3",{style:{margin:0,fontSize:"14px",fontWeight:500,lineHeight:"20px",color:"var(--yt-spec-text-primary, #0f0f0f)",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:o.title}),i.jsx("p",{style:{margin:0,fontSize:"12px",color:"var(--yt-spec-text-secondary, #606060)"},children:o.channelName}),i.jsx("p",{style:{margin:0,fontSize:"12px",color:"var(--yt-spec-text-secondary, #606060)"},children:o.publishedTimeStr})]})]})},o.id))})},A=({channelId:n,channelName:e,onClose:r,style:t})=>{const[s,o]=d.useState([]),[l,c]=d.useState(null);d.useEffect(()=>{C().then(o)},[]);const y=async u=>{await T(u,{id:n,name:e}),c(u);const p=await C();o(p),setTimeout(()=>r(),600)};return i.jsxs("div",{style:{position:"absolute",top:"40px",left:0,background:"var(--yt-spec-base-background, #fff)",border:"1px solid var(--yt-spec-10-percent-layer, #ccc)",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.3)",padding:"12px",zIndex:9999,width:"250px",color:"var(--yt-spec-text-primary, #0f0f0f)",fontFamily:"Roboto, Arial, sans-serif",...t},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[i.jsx("h4",{style:{margin:0,fontSize:"14px",fontWeight:500},children:"Add to Feed"}),i.jsx("button",{onClick:r,style:{color:"var(--yt-spec-text-primary)",background:"none",border:"none",cursor:"pointer",fontSize:"16px"},children:"âœ•"})]}),i.jsxs("p",{style:{margin:"0 0 12px 0",fontSize:"12px",color:"var(--yt-spec-text-secondary, #606060)"},children:['Select a category for "',e,'"']}),s.length===0?i.jsx("div",{style:{fontSize:"12px",color:"var(--yt-spec-text-secondary, #606060)"},children:"No categories created yet. Create one in the extension popup."}):i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:s.map(u=>{const p=u.channels.some(R=>R.id===n);return i.jsxs("button",{onClick:()=>!p&&y(u.id),disabled:p,style:{padding:"6px 12px",borderRadius:"4px",border:"1px solid var(--yt-spec-10-percent-layer, #ddd)",background:p?"var(--yt-spec-10-percent-layer, #f0f0f0)":"transparent",color:p?"var(--yt-spec-text-secondary, #888)":"var(--yt-spec-text-primary, #0f0f0f)",cursor:p?"default":"pointer",textAlign:"left",fontSize:"13px"},children:[u.name," ",p&&"âœ“"]},u.id)})})]})},k=({channelId:n,channelName:e})=>{const[r,t]=d.useState(!1);return i.jsxs("div",{style:{position:"relative",display:"inline-block",marginLeft:"8px"},children:[i.jsxs("button",{onClick:()=>t(!r),style:{background:"var(--yt-spec-badge-chip-background, rgba(0,0,0,0.05))",border:"none",borderRadius:"18px",padding:"0 16px",height:"36px",fontSize:"14px",fontWeight:500,color:"var(--yt-spec-text-primary, #0f0f0f)",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},className:"betteryt-add-btn",children:[i.jsx("span",{children:"âž•"})," Add to Feed"]}),r&&i.jsx(A,{channelId:n,channelName:e,onClose:()=>t(!1)})]})};let w=null,f=null,h=null,a=null,S="";const x="betteryt-reset-chip",j="betteryt-hide-style",b="data-betteryt-injected",z=()=>{if(document.getElementById(j))return;const n=document.createElement("style");n.id=j,n.textContent=`
    ytd-rich-grid-renderer { display: none !important; }
    ytd-browse[page-subtype="home"] #contents.ytd-rich-grid-renderer { display: none !important; }
  `,document.head.appendChild(n)},E=()=>{document.getElementById(j)?.remove()},B=()=>{const n=document.getElementById("betteryt-feed-container");n&&(n.style.display="none")},F=n=>{let e=document.getElementById("betteryt-feed-container");if(!e){e=document.createElement("div"),e.id="betteryt-feed-container";const r=document.querySelector('ytd-browse[page-subtype="home"] ytd-rich-grid-renderer'),t=document.querySelector('ytd-browse[page-subtype="home"] ytd-two-column-browse-results-renderer #primary');if(r&&r.parentElement)r.parentElement.insertBefore(e,r.nextSibling);else if(t)t.appendChild(e);else{console.warn("[BetterYT] Could not find a container to inject feed.");return}}e.style.display="block",f||(f=m.createRoot(e)),f.render(i.jsx(q,{category:n}))},L=()=>{const[n,e]=d.useState([]),[r,t]=d.useState(null);d.useEffect(()=>{C().then(e);const o=c=>{c.categories&&e(c.categories.newValue||[])};chrome.storage.onChanged.addListener(o);const l=()=>t(null);return window.addEventListener(x,l),()=>{chrome.storage.onChanged.removeListener(o),window.removeEventListener(x,l)}},[]);const s=d.useCallback(o=>{t(l=>l===o.id?(E(),B(),null):(z(),F(o),document.querySelectorAll("ytd-feed-filter-chip-bar-renderer yt-chip-cloud-chip-renderer").forEach(c=>{c.closest("#betteryt-custom-chips")||(c.removeAttribute("selected"),c.setAttribute("aria-selected","false"))}),o.id))},[]);return n.length===0?null:i.jsx(i.Fragment,{children:n.map(o=>i.jsx("div",{onClick:()=>s(o),style:{cursor:"pointer",background:r===o.id?"var(--yt-spec-text-primary, #0f0f0f)":"var(--yt-spec-badge-chip-background, rgba(0,0,0,0.05))",color:r===o.id?"var(--yt-spec-base-background, #fff)":"var(--yt-spec-text-primary, #0f0f0f)",padding:"0 12px",height:"32px",borderRadius:"8px",display:"inline-flex",alignItems:"center",fontSize:"14px",fontWeight:500,whiteSpace:"nowrap",transition:"background-color 0.15s, color 0.15s",flexShrink:0},children:o.name},o.id))})},N=()=>{if(document.getElementById("betteryt-custom-chips"))return;const n=document.querySelector("ytd-feed-filter-chip-bar-renderer #chips yt-chip-cloud-renderer #chips")||document.querySelector("ytd-feed-filter-chip-bar-renderer #chips");if(!n)return;const e=document.createElement("div");e.id="betteryt-custom-chips",e.style.display="inline-flex",e.style.gap="8px",e.style.marginRight="8px",e.style.flexShrink="0",n.insertBefore(e,n.firstChild),w=m.createRoot(e),w.render(i.jsx(L,{}))};let g=null;const I=()=>{let n=g?.id||"",e=g?.name||"";const r=document.querySelectorAll("#owner ytd-channel-name a, #owner-name a");for(const t of Array.from(r)){const s=t.getAttribute("href")||"";if(!n&&s.includes("/channel/UC")){const l=s.match(/\/channel\/(UC[a-zA-Z0-9_-]+)/);l&&(n=l[1])}const o=t.getAttribute("data-browse-id");if(!n&&o&&o.startsWith("UC")&&(n=o),!e&&t.textContent?.trim()&&(e=t.textContent.trim()),n&&e)break}if(!n){const t=document.querySelector('link[rel="canonical"]');if(t){const o=(t.getAttribute("href")||"").match(/youtube\.com\/channel\/(UC[a-zA-Z0-9_-]+)/);o&&(n=o[1])}}if(!e){const t=document.querySelector("#channel-header ytd-channel-name yt-formatted-string, #channel-name yt-formatted-string");t&&(e=t.textContent?.trim()||"")}if(!n){const t=document.querySelector('meta[itemprop="channelId"]');t&&(n=t.getAttribute("content")||"")}return n?{id:n,name:e||n}:null},D=n=>{let e="",r="";const t=n.querySelectorAll("a");for(const o of Array.from(t)){const c=(o.getAttribute("href")||"").match(/\/channel\/(UC[a-zA-Z0-9_-]+)/);c&&(e=c[1]);const y=o.getAttribute("data-browse-id");y&&y.startsWith("UC")&&(e=y)}const s=n.querySelector("ytd-channel-name a, #channel-name a, .ytd-channel-name a");return s&&s.textContent&&(r=s.textContent.trim()),e&&r?{id:e,name:r}:null},W=()=>{if(window.location.pathname!=="/")return;document.querySelectorAll(`ytd-rich-item-renderer:not([${b}])`).forEach(e=>{e.setAttribute(b,"true");const r=D(e);if(!r)return;const t=e.querySelector("ytd-thumbnail, #thumbnail");if(!t)return;t.style.position="relative";const s=document.createElement("div");s.className="betteryt-thumb-btn",s.style.cssText=`
      position: absolute;
      bottom: 8px;
      right: 8px;
      z-index: 500;
      opacity: 0;
      transition: opacity 0.15s;
      pointer-events: auto;
    `,t.addEventListener("mouseenter",()=>{s.style.opacity="1"}),t.addEventListener("mouseleave",()=>{s.style.opacity="0"}),t.appendChild(s),m.createRoot(s).render(i.jsx(M,{channelId:r.id,channelName:r.name}))})},M=({channelId:n,channelName:e})=>{const[r,t]=d.useState(!1);return i.jsxs("div",{style:{position:"relative"},onClick:s=>{s.preventDefault(),s.stopPropagation()},children:[i.jsx("button",{onClick:s=>{s.preventDefault(),s.stopPropagation(),t(!r)},style:{background:"rgba(0, 0, 0, 0.7)",border:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"12px",fontWeight:500,color:"#fff",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",whiteSpace:"nowrap"},title:`Add ${e} to a feed`,children:"âž• Feed"}),r&&i.jsx(A,{channelId:n,channelName:e,onClose:()=>t(!1),style:{top:"auto",bottom:"36px",left:"auto",right:0}})]})},_=()=>{if(window.location.pathname!=="/watch")return;const n=window.location.href;if(a&&S===n)return;a&&(a.remove(),a=null,h=null);const e=I();if(!e)return;const r=document.querySelector("#top-row #actions.ytd-watch-metadata")||document.querySelector("#actions.ytd-watch-metadata")||document.querySelector("ytd-watch-metadata #actions"),t=document.querySelector("#owner.ytd-watch-metadata")||document.querySelector("ytd-video-owner-renderer");(r||t)&&(a=document.createElement("div"),a.id="betteryt-add-btn-container",a.style.display="inline-flex",a.style.alignItems="center",r?r.insertBefore(a,r.firstChild):t&&t.appendChild(a),h=m.createRoot(a),h.render(i.jsx(k,{channelId:e.id,channelName:e.name})),S=n)},H=()=>{if(!/^\/(channel\/|@|c\/)/.test(window.location.pathname)||document.getElementById("betteryt-channel-add-btn"))return;const e=I();if(!e)return;const r=document.querySelector("ytd-c4-tabbed-header-renderer #subscribe-button")||document.querySelector("#subscribe-button");if(!r)return;const t=document.createElement("div");t.id="betteryt-channel-add-btn",t.style.display="inline-flex",t.style.alignItems="center",t.style.marginLeft="8px",r.parentElement?.insertBefore(t,r.nextSibling),m.createRoot(t).render(i.jsx(k,{channelId:e.id,channelName:e.name}))},U=n=>{const r=n.target.closest("yt-chip-cloud-chip-renderer");r&&!r.closest("#betteryt-custom-chips")&&(window.dispatchEvent(new Event(x)),E(),B())},O=n=>{if(n?.detail?.response?.playerResponse?.videoDetails){const t=n.detail.response.playerResponse.videoDetails;g={id:t.channelId,name:t.author}}else g=null;const e=document.getElementById("betteryt-custom-chips");e&&(e.remove(),w=null),a&&(a.remove(),a=null,h=null,S=""),document.getElementById("betteryt-channel-add-btn")?.remove();const r=document.getElementById("betteryt-feed-container");r&&(f&&(f.unmount(),f=null),r.remove()),document.querySelectorAll(`[${b}]`).forEach(t=>{t.removeAttribute(b),t.querySelectorAll(".betteryt-thumb-btn").forEach(s=>s.remove())}),E(),window.dispatchEvent(new Event(x))};let v=null;const P=()=>{v||(v=setTimeout(()=>{v=null,N(),_(),H(),W()},200))},V=new MutationObserver(P);V.observe(document.body,{childList:!0,subtree:!0});document.addEventListener("yt-navigate-finish",O);document.addEventListener("click",U,!0);console.log("[BetterYT] Content script loaded.");
