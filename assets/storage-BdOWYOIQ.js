const g="betteryt_config",w=async()=>(await chrome.storage.local.get(g))[g]||{youtubeApiKey:"",openaiApiKey:""},h=async e=>{await chrome.storage.local.set({[g]:e})},f=()=>{const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},u=e=>{const a=e.channels.map(t=>t.id).sort().join(","),n=(e.seeds||[]).map(t=>`${t.kind}:${t.id}`).sort().join(",");return`${a}|${n}`},c=async()=>{const a=(await chrome.storage.local.get("categories")).categories||[];let n=!1;for(const t of a)t.seeds||(t.seeds=t.channels.map(s=>({kind:"channel",id:s.id,channelId:s.id,title:s.name,addedAt:Date.now()})),n=!0);return n&&await o(a),a},o=async e=>{await chrome.storage.local.set({categories:e})},m=async e=>{const a=await c(),n={id:Date.now().toString(),name:e,channels:[],seeds:[]};return a.push(n),await o(a),n},y=async(e,a)=>{const n=await c(),t=n.find(s=>s.id===e);t&&(t.name=a,await o(n))},C=async e=>{let a=await c();a=a.filter(n=>n.id!==e),await o(a),await r(e)},p=async(e,a)=>{const n=await c(),t=n.find(s=>s.id===e);t&&(t.channels.some(s=>s.id===a.id)||(t.channels.push(a),t.seeds||(t.seeds=[]),t.seeds.some(s=>s.kind==="channel"&&s.id===a.id)||t.seeds.push({kind:"channel",id:a.id,channelId:a.id,title:a.name,addedAt:Date.now()}),await o(n),await r(e)))},k=async(e,a)=>{const n=await c(),t=n.find(s=>s.id===e);t&&(t.channels=t.channels.filter(s=>s.id!==a),t.seeds&&(t.seeds=t.seeds.filter(s=>!(s.kind==="channel"&&s.id===a))),await o(n),await r(e))},S=async(e,a,n,t)=>{const s=await c(),i=s.find(d=>d.id===e);i&&(i.seeds||(i.seeds=[]),i.seeds.some(d=>d.kind==="video"&&d.id===a)||(i.seeds.push({kind:"video",id:a,channelId:n,title:t,addedAt:Date.now()}),await o(s),await r(e)))},v=async(e,a,n)=>{const t=await c(),s=t.find(i=>i.id===e);s&&s.seeds&&(s.seeds=s.seeds.filter(i=>!(i.kind===a&&i.id===n)),await o(t),await r(e))},l="suggestion_cache_",D=async e=>{const a=l+e;return(await chrome.storage.local.get(a))[a]||null},A=async e=>{const a=l+e.categoryId;await chrome.storage.local.set({[a]:e})},r=async e=>{const a=l+e;await chrome.storage.local.remove(a)},F=async()=>{const e=await chrome.storage.local.get(null),a=Object.keys(e).filter(n=>n.startsWith(l));a.length>0&&await chrome.storage.local.remove(a)},$=(e,a)=>!(!e||e.cacheDate!==f()||e.sourceFingerprint!==u(a));export{S as a,p as b,w as c,F as d,D as e,$ as f,c as g,u as h,r as i,f as j,h as k,m as l,C as m,v as n,k as r,A as s,y as u};
